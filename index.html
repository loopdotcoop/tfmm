<!DOCTYPE html>
<html lang="en">
<head>
  <title>Tfmm</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <meta name="generator" content="Apage 0.0.22 http://apage.richplastow.com/">
  <style>
    /* ‘Inspect Element’ here, for Apage’s injected CSS */
  </style>

  <script>

//// When the DOM is ready, set up Apage and inject the plugins. 
window.addEventListener('load', function () { (function (d) { 'use strict'; 


//// Declare iterator, length and HTML-reference variables. 
var i, l, $ref


//// Initialize three arrays which are available to all Apage plugins. 
 ,arts      = []
 ,resolvers = []
 ,updaters  = []


//// Like jQuery, but native. 
 ,$  = d.querySelector.bind(d)
 ,$$ = d.querySelectorAll.bind(d)


//// Get a reference to all `<article class="apage">` elements. 
 ,$arts = $$('article.apage')


//// Convert JavaScript’s native `arguments` object to an array. 
 ,getArgs = function (args, offset) {
    return Array.prototype.slice.call(args, offset || 0);
 }


//// `unattribute($ref,'data-apage-','opath'...)` removes data attributes. 
 ,unattribute = function ($ref, prefix) {
    for ( var i=0, suffs=getArgs(arguments,2), l=suffs.length; i<l; i++ ) {
      $ref.removeAttribute(prefix + suffs[i]);
    }
  }


//// Runs each resolver in order. These are added by the plugins, below. 
//// Resolvers are used to map a query to an article. 
 ,resolve = function (query) {
    for (var i=0, l=resolvers.length, backstop, result={}; i<l; i++) {
      result = resolvers[i](query);
      if (result.art) { break; } // `query` does resolve to an article
      backstop = result.backstop || backstop; // may return a backstop
    }
    return result.art ? result.art : backstop; //@todo test logic of 'last valid backstop return' with several plugins at once
  }


//// Runs each updater in order. These are added by the plugins, below. 
//// Updaters change the current DOM state, eg to show a single article. 
 ,update = function (query) {
    for (var i=0, l=updaters.length, current=resolve(query); i<l; i++) {
      updaters[i](current);
    }
  }


//// Tidies the URL hash and runs `update()` when the URL hash changes. 
 ,onHashchange = function (event) {
    update( window.location.hash.substr(1).replace(/\//g,'_') );
    if (event) { event.preventDefault(); }
  }

;


//// Populate the `arts` array using data from Apage `<ARTICLE>` elements. 
//// Then, remove all 'data-apage-*' attributes except 'data-apage-dname'. 
for (i=0, l=$arts.length; i<l; i++) {
  $ref = $arts[i];
  arts.push({
    id:    $ref.getAttribute('id')
   ,opath: $ref.getAttribute('data-apage-opath')
   ,dname: $ref.getAttribute('data-apage-dname')
   ,order: $ref.getAttribute('data-apage-order')
   ,front: JSON.parse( $ref.getAttribute('data-apage-front') )
   ,title: $ref.getAttribute('data-apage-title')
   ,$ref:  $ref
  });
  unattribute($ref,'data-apage-','opath','order','front','title');
}


//// Begin injecting plugins. 

// Generated by CoffeeScript 1.9.2

/*! Apage 0.0.22 //// MIT Licence //// http://apage.richplastow.com/
 *  plugin/cross-browser.litcoffee
 */

(function() {
  $('style').innerHTML += "\n/* injected by Apage’s CrossBrowser plugin, and adapted from: */\n/* normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */\n\n/* Document */\nhtml { font-family:sans-serif; -ms-text-size-adjust:100%; -webkit-text-size-adjust:100% }\nbody { margin:0 }\n\n/* HTML5 */\narticle,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,\nsection,summary { display:block }\naudio,canvas,progress,video { display:inline-block; vertical-align:baseline }\naudio:not([controls]) { display:none; height:0 }\n[hidden],template { display:none }\n\n/* Links */\na { background-color:transparent }\na:active,a:hover { outline:0 }\n\n/* Text */\nabbr[title] { border-bottom:1px dotted }\nb, strong { font-weight:bold }\ndfn { font-style:italic }\nh1 { font-size:2em; margin:0.67em 0 }\nmark { background:#ff0; color:#000 }\nsmall { font-size:80% }\nsub,sup { font-size:75%; line-height:0; position:relative; vertical-align:baseline }\nsup { top:-0.5em }\nsub { bottom:-0.25em }\n\n/* Embedded */\nimg { border:0 }\nsvg:not(:root) { overflow:hidden }\n\n/* Grouping */\nfigure { margin:1em 40px }\nhr { box-sizing:content-box; height:0 }\npre { overflow:auto }\ncode,kbd,pre,samp { font-family:monospace,monospace; font-size:1em }\n\n/* Forms */\nbutton,input,optgroup,select,textarea { color:inherit; font:inherit; margin:0 }\nbutton { overflow:visible }\nbutton,select { text-transform:none }\nbutton,html input[type=\"button\"],input[type=\"reset\"],\ninput[type=\"submit\"] { -webkit-appearance:button; cursor:pointer }\nbutton[disabled],html input[disabled] { cursor:default }\nbutton::-moz-focus-inner,input::-moz-focus-inner{ border:0; padding:0 }\ninput { line-height:normal }\ninput[type=\"checkbox\"],input[type=\"radio\"] { box-sizing:border-box; padding:0 }\ninput[type=\"number\"]::-webkit-inner-spin-button,\ninput[type=\"number\"]::-webkit-outer-spin-button { height:auto }\ninput[type=\"search\"] { -webkit-appearance:textfield; box-sizing:content-box }\ninput[type=\"search\"]::-webkit-search-cancel-button,\ninput[type=\"search\"]::-webkit-search-decoration { -webkit-appearance:none }\nfieldset { border:1px solid #c0c0c0; margin:0 2px; padding:0.35em 0.625em 0.75em }\nlegend { border:0; padding:0 }\ntextarea { overflow:auto }\noptgroup { font-weight:bold }\n\n/* Tables */\ntable { border-collapse:collapse; border-spacing:0 }\ntd,th { padding:0 }\n";

}).call(this);
// Generated by CoffeeScript 1.9.2

/*! Apage 0.0.22 //// MIT Licence //// http://apage.richplastow.com/
 *  plugin/pagination.litcoffee
 */

(function() {
  var $ref, art, i, len;

  $('style').innerHTML += "\n/* injected by Apage’s Pagination plugin */\narticle { display: none; }\narticle.active { display: block; }";

  $ref = document.createElement('article');

  $ref.setAttribute('class', 'apage');

  $ref.setAttribute('id', 'apage_undefined');

  $ref.innerHTML = "<!-- injected by Apage’s Pagination plugin -->\n<h1>Article Not Found</h1>";

  d.body.appendChild($ref);

  arts.push({
    id: 'undefined',
    opath: '',
    dname: '',
    order: 0,
    front: [],
    title: 'Article Not Found',
    $ref: $ref
  });

  for (i = 0, len = arts.length; i < len; i++) {
    art = arts[i];
    arts[art.id] = art;
  }

  arts['_'] = arts[0] || arts.undefined;

  resolvers.push(function(query) {
    if (!query) {
      return {
        art: arts[0]
      };
    }
    if (arts[query]) {
      return {
        art: arts[query]
      };
    }
    query = 'apage' + query;
    if (arts[query]) {
      return {
        art: arts[query]
      };
    }
    return {
      backstop: arts.undefined
    };
  });

  updaters.push(function(current) {
    var j, len1;
    for (j = 0, len1 = arts.length; j < len1; j++) {
      art = arts[j];
      art.$ref.className = art.$ref.className.replace(/\s*active|\s*$/g, '');
    }
    current.$ref.className += ' active';
    return d.title = current.title;
  });

}).call(this);
// Generated by CoffeeScript 1.9.2

/*! Tfmm 0.0.14 //// MIT Licence //// http://tfmm.loop.coop/ */

(function() {
  var Asset, AssetManager, Blot, Flourish, Maestro, Main, MicIn, Voice, VoiceSet, ª, ªA, ªB, ªE, ªF, ªI, ªN, ªO, ªR, ªS, ªU, ªV, ªX, ªclone, ªex, ªhas, ªpopulate, ªredefine, ªretrieve, ªtype, ªuid,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  ªI = 'Tfmm';

  ªV = '0.0.14';

  ªA = 'array';

  ªB = 'boolean';

  ªE = 'error';

  ªF = 'function';

  ªN = 'number';

  ªO = 'object';

  ªR = 'regexp';

  ªS = 'string';

  ªU = 'undefined';

  ªX = 'null';

  ª = console.log.bind(console);

  ªex = function(x, a, b) {
    var pos;
    if (-1 === (pos = a.indexOf(x))) {
      return x;
    } else {
      return b.charAt(pos);
    }
  };

  ªhas = function(h, n, t, f) {
    if (t == null) {
      t = true;
    }
    if (f == null) {
      f = false;
    }
    if (-1 !== h.indexOf(n)) {
      return t;
    } else {
      return f;
    }
  };

  ªtype = function(x) {
    return {}.toString.call(x).match(/\s([a-z|A-Z]+)/)[1].toLowerCase();
  };

  ªuid = function(p) {
    return p + '_' + (Math.random() + '1111111111111111').slice(2, 18);
  };

  ªredefine = function(obj, name, value, kind) {
    switch (kind) {
      case 'constant':
        return Object.defineProperty(obj, name, {
          value: value,
          enumerable: true
        });
      case 'private':
        return Object.defineProperty(obj, name, {
          value: value,
          enumerable: false
        });
    }
  };

  ªretrieve = function(instances, identifier) {
    var instance;
    instance = instances[identifier];
    if (!instance) {
      switch (typeof identifier) {
        case ªS:
          throw new Error("'" + identifier + "' does not exist");
          break;
        case ªN:
          throw new Error("`" + identifier + "` does not exist");
          break;
        case ªU:
          throw new Error("`identifier` is `undefined`");
          break;
        default:
          throw new Error("`identifier` is type '" + (ªtype(identifier)) + "'");
      }
    }
    return instance;
  };

  ªpopulate = function(candidate, subject, rules, updating) {
    var errors, j, key, l, len, len1, rule, test, type, use, value;
    if (ªO !== ªtype(candidate)) {
      throw new Error("`candidate` is type '" + (ªtype(candidate)) + "' not 'object'");
    }
    errors = [];
    for (j = 0, len = rules.length; j < len; j++) {
      rule = rules[j];
      key = rule[0], use = rule[1], type = rule[2], test = rule[3];
      value = candidate[key];
      if (void 0 === value) {
        if (updating || void 0 !== use) {
          continue;
        } else {
          errors.push("Missing field '" + key + "' is mandatory");
        }
      } else if (type !== ªtype(value)) {
        errors.push("Field '" + key + "' is type '" + (ªtype(value)) + "' not '" + type + "'");
      } else if (!test.test(value)) {
        errors.push("Field '" + key + "' is '" + value + "' which fails " + ('' + test));
      }
    }
    if (errors.length) {
      throw new Error(errors.join('\n'));
    }
    for (l = 0, len1 = rules.length; l < len1; l++) {
      rule = rules[l];
      key = rule[0], use = rule[1], type = rule[2], test = rule[3];
      value = candidate[key];
      if (void 0 === value) {
        if (void 0 === subject[key]) {
          if (ªA === ªtype(use)) {
            subject[key] = use[0].apply(this, use.slice(1));
          } else {
            subject[key] = use;
          }
        }
      } else {
        subject[key] = value;
      }
    }
  };

  ªclone = function(subject, rules) {
    var j, key, len, out, rule;
    out = {};
    for (j = 0, len = rules.length; j < len; j++) {
      rule = rules[j];
      key = ªS === typeof rule ? rule : rule[0];
      out[key] = subject[key];
    }
    return out;
  };

  Asset = (function() {
    Asset.prototype.C = 'Asset';

    Asset.prototype.toString = function() {
      return "[object " + this.C + "]";
    };

    function Asset(config) {
      if (config == null) {
        config = {};
      }
      this.setManager = bind(this.setManager, this);
      this.completeHandler = bind(this.completeHandler, this);
      this.loadHandler = bind(this.loadHandler, this);
      this.abortHandler = bind(this.abortHandler, this);
      this.errorHandler = bind(this.errorHandler, this);
      this.progressHandler = bind(this.progressHandler, this);
      this.state = 'init';
      this.progress = 0;
      this.manager = null;
      this.url = config.url;
      this.request = null;
      this.buffer = null;
    }

    Asset.prototype.load = function() {
      if ('init' !== this.state) {
        return 0;
      }
      this.state = 'loading';
      this.request = new XMLHttpRequest;
      this.request.addEventListener('progress', this.progressHandler, false);
      this.request.addEventListener('error', this.errorHandler, false);
      this.request.addEventListener('abort', this.abortHandler, false);
      this.request.addEventListener('load', this.loadHandler, false);
      this.request.open('GET', this.url, true);
      this.request.responseType = 'arraybuffer';
      this.request.send();
      return 1;
    };

    Asset.prototype.progressHandler = function(event) {
      if (event.lengthComputable) {
        this.progress = event.loaded / event.total;
        return this.manager.progressHandler();
      }
    };

    Asset.prototype.errorHandler = function(event) {
      ª(event);
      return this.manager.completeHandler('oh no, error!');
    };

    Asset.prototype.abortHandler = function(event) {
      ª(event);
      return this.manager.completeHandler('oh no, abort!');
    };

    Asset.prototype.loadHandler = function() {
      if (200 !== this.request.status) {
        return this.manager.completeHandler("Load error, status " + this.request.status);
      } else {
        this.state = 'processing';
        this.progress = 1;
        return this.manager.audioCtx.decodeAudioData(this.request.response, this.completeHandler, this.errorHandler);
      }
    };

    Asset.prototype.completeHandler = function(buffer) {
      this.buffer = buffer;
      this.state = 'complete';
      return this.manager.completeHandler();
    };

    Asset.prototype.setManager = function(manager) {
      if (!(manager instanceof AssetManager)) {
        throw new Error("`manager` must be an instance of `AssetManager`");
      }
      return this.manager = manager;
    };

    return Asset;

  })();

  AssetManager = (function() {
    AssetManager.prototype.C = 'AssetManager';

    AssetManager.prototype.toString = function() {
      return "[object " + this.C + "]";
    };

    function AssetManager(config) {
      if (config == null) {
        config = {};
      }
      this.audioCtx = config.audioCtx;
      this.progress = 0;
      this.assets = [];
      this.onProgress = config.onProgress || function() {};
      this.onComplete = config.onComplete || function() {};
    }

    AssetManager.prototype.add = function(asset) {
      if (!(asset instanceof Asset)) {
        throw new Error("`asset` must be an instance of `Asset`");
      }
      asset.setManager(this);
      this.assets.push(asset);
      return this;
    };

    AssetManager.prototype.load = function() {
      var asset;
      return ((function() {
        var j, len, ref, results;
        ref = this.assets;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          asset = ref[j];
          results.push(asset.load());
        }
        return results;
      }).call(this)).reduce(function(a, b) {
        return a + b;
      });
    };

    AssetManager.prototype.progressHandler = function() {
      var i, progress;
      progress = 0;
      i = this.assets.length;
      while (i--) {
        progress += this.assets[i].progress;
      }
      return this.onProgress(progress / this.assets.length);
    };

    AssetManager.prototype.completeHandler = function(error) {
      var i;
      if (error) {
        return this.onComplete(error);
      }
      i = this.assets.length;
      while (i--) {
        if ('complete' !== this.assets[i].state) {
          return;
        }
      }
      return this.onComplete();
    };

    return AssetManager;

  })();

  Blot = (function() {
    Blot.prototype.C = 'Blot';

    Blot.prototype.toString = function() {
      return "[object " + this.C + "]";
    };

    function Blot(config) {
      if (config == null) {
        config = {};
      }
      this.xx = null;
    }

    return Blot;

  })();

  Blot.square = function(time, velocity, ctx2d, size) {
    var scale, topleft;
    scale = size * velocity * (1 - time);
    topleft = (size - scale) / 2;
    return ctx2d.fillRect(topleft, topleft, scale, scale);
  };

  Blot.circle = function(time, velocity, ctx2d, size) {
    var center, radius;
    radius = size * velocity * (1 - time);
    center = size / 2;
    ctx2d.beginPath();
    ctx2d.arc(center, center, radius / 2, 0, 2 * Math.PI);
    return ctx2d.fill();
  };

  Blot.triangle = function(time, velocity, ctx2d, size) {
    var center, halfScale, scale;
    scale = size * velocity * (1 - time);
    halfScale = scale / 2;
    center = size / 2;
    ctx2d.beginPath();
    ctx2d.moveTo(center, center - halfScale);
    ctx2d.lineTo(center + halfScale, center + scale);
    ctx2d.lineTo(center - halfScale, center + scale);
    return ctx2d.fill();
  };

  Blot.dots = function(time, velocity, ctx2d, size) {
    var i;
    i = 5;
    while (--i) {
      ctx2d.setTransform(1 / i * velocity, 0, 0, .5 / i, ((size * i) / 4 - (size / 4)) / 2, size / 2 - (size / 4 * velocity));
      Blot.circle(time, velocity, ctx2d, size);
    }
    return ctx2d.setTransform(1, 0, 0, 1, 0, 0);
  };

  Blot.galaxy = function(time, velocity, ctx2d, size) {
    var i;
    time = 1 - time;
    i = 5;
    while (i--) {
      ctx2d.setTransform(.5 / time, 0, 0, .5 / time / i, size / i / 4, size / 4);
      Blot.circle(time, velocity, ctx2d, size);
    }
    return ctx2d.setTransform(1, 0, 0, 1, 0, 0);
  };

  Blot.oddtriangle = function(time, velocity, ctx2d, size) {
    var center, halfScale, scale;
    scale = size * velocity * (1 - time);
    halfScale = scale / 2;
    center = size / 2;
    ctx2d.beginPath();
    ctx2d.moveTo(center, center - halfScale);
    ctx2d.lineTo(center + halfScale, scale);
    ctx2d.lineTo(center - halfScale, scale);
    return ctx2d.fill();
  };

  Flourish = (function() {
    Flourish.prototype.C = 'Flourish';

    Flourish.prototype.toString = function() {
      return "[object " + this.C + "]";
    };

    function Flourish(config) {
      if (config == null) {
        config = {};
      }
      this.voice = config.voice;
      this.blotRenderer = config.blotRenderer;
      this.hasScheduled = false;
      this.start = config.start;
      this.duration = config.duration;
      this.velocity = config.velocity;
    }

    Flourish.prototype.render = function(frame, ctx2d, size) {
      var now, time;
      now = frame.frac2000;
      if (this.start + this.duration < now) {
        return;
      }
      if (this.start > now) {
        return this.lookahead(now, frame);
      }
      this.hasScheduled = false;
      time = 1 / (this.duration / (now - this.start));
      return this.blotRenderer(time, this.velocity, ctx2d, size);
    };

    Flourish.prototype.lookahead = function(now, frame) {
      if (this.hasScheduled || this.start > now + 0.1) {
        return;
      }
      this.hasScheduled = true;
      return this.voice.play(this.velocity, frame.stamp + (this.start - now) * 2000);
    };

    return Flourish;

  })();

  Maestro = (function() {
    Maestro.prototype.C = 'Maestro';

    Maestro.prototype.toString = function() {
      return "[object " + this.C + "]";
    };

    function Maestro(config) {
      if (config == null) {
        config = {};
      }
      this.step = bind(this.step, this);
      this.audioCtx = config.audioCtx;
      this.renderers = config.renderers || [];
      if (config.raf) {
        this.raf = config.raf.bind(this);
      } else {
        this.raf = window.requestAnimationFrame.bind(window);
      }
      this.prevFlip2000 = -1;
    }

    Maestro.prototype.start = function() {
      return this.raf(this.step);
    };

    Maestro.prototype.step = function(stamp) {
      var cue, currFlip2000, flip2000, flip8000, fn, j, len, ref, renderer;
      currFlip2000 = stamp % 2000;
      if (currFlip2000 >= this.prevFlip2000) {
        flip2000 = false;
      } else {
        flip2000 = true;
        if (currFlip2000 === stamp % 8000) {
          flip8000 = true;
        } else {
          flip8000 = false;
        }
      }
      this.prevFlip2000 = currFlip2000;
      cue = {
        stamp: stamp,
        flip2000: flip2000,
        flip8000: flip8000,
        frac2000: (stamp % 2000) / 2000,
        frac8000: (stamp % 8000) / 8000
      };
      ref = this.renderers;
      fn = function(renderer) {
        return renderer.render(cue);
      };
      for (j = 0, len = ref.length; j < len; j++) {
        renderer = ref[j];
        fn(renderer);
      }
      return this.raf(this.step);
    };

    return Maestro;

  })();

  Main = (function() {
    Main.prototype.C = ªI;

    Main.prototype.toString = function() {
      return "[object " + this.C + "]";
    };

    function Main(config) {
      if (config == null) {
        config = {};
      }
      this.updater = bind(this.updater, this);
      this.onLoadComplete = bind(this.onLoadComplete, this);
      this.onLoadProgress = bind(this.onLoadProgress, this);
      this.audioCtx = new (window.AudioContext || window.webkitAudioContext);
      this.active = null;
      this.arts = config.arts;
      this.maestro = new Maestro({
        audioCtx: this.audioCtx
      });
      this.$$voiceSets = config.$$voiceSets;
      this.voiceSets = this.initVoiceSets();
      this.maestro.renderers = this.voiceSets;
      this.$progressWrap = document.createElement('div');
      this.$progressWrap.setAttribute('id', 'progress-wrap');
      document.body.appendChild(this.$progressWrap);
      this.$progressBar = document.createElement('span');
      this.$progressBar.setAttribute('id', 'progress-bar');
      this.$progressWrap.appendChild(this.$progressBar);
      this.assetManager = this.initAssetManager();
      this.assetManager.load();
    }

    Main.prototype.initVoiceSets = function() {
      var $voiceSet, j, len, ref, results;
      ref = this.$$voiceSets;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        $voiceSet = ref[j];
        results.push((function(_this) {
          return function($voiceSet) {
            var fn, front, k, l, len1, ref1, ref2, v;
            front = {};
            ref1 = _this.arts[$voiceSet.id].front;
            fn = function(k, v) {
              return front[k] = v;
            };
            for (l = 0, len1 = ref1.length; l < len1; l++) {
              ref2 = ref1[l], k = ref2[0], v = ref2[1];
              fn(k, v);
            }
            return _this.arts[$voiceSet.id].voiceSet = new VoiceSet({
              $voiceSet: $voiceSet,
              front: front,
              maestro: _this.maestro
            });
          };
        })(this)($voiceSet));
      }
      return results;
    };

    Main.prototype.initAssetManager = function() {
      var assetManager, j, l, len, len1, ref, ref1, voice, voiceSet;
      assetManager = new AssetManager({
        onProgress: this.onLoadProgress,
        onComplete: this.onLoadComplete,
        audioCtx: this.audioCtx
      });
      ref = this.voiceSets;
      for (j = 0, len = ref.length; j < len; j++) {
        voiceSet = ref[j];
        ref1 = voiceSet.voices;
        for (l = 0, len1 = ref1.length; l < len1; l++) {
          voice = ref1[l];
          assetManager.add(voice.sample);
        }
      }
      return assetManager;
    };

    Main.prototype.onLoadProgress = function(progress) {
      return this.$progressBar.style.width = (progress * 100) + "%";
    };

    Main.prototype.onLoadComplete = function(error) {
      if (error) {
        return ª(error);
      } else {
        document.body.setAttribute('class', 'complete');
        this.enableUserInput();
        return this.maestro.start();
      }
    };

    Main.prototype.enableUserInput = function() {
      var $voiceSet, e, j, len, micIn, ref, results;
      try {
        micIn = new MicIn({
          ctxAudio: this.audioCtx,
          maestro: this.maestro,
          callback: {
            threshold: 0.5,
            fn: (function(_this) {
              return function(velocity) {
                if (null === _this.active) {
                  return;
                }
                return _this.active.trigger(velocity);
              };
            })(this)
          }
        });
      } catch (_error) {
        e = _error;
        alert(e);
      }
      window.addEventListener('keydown', (function(_this) {
        return function(event) {
          if (null === _this.active) {
            return;
          }
          if (81 === event.keyCode) {
            return _this.active.trigger(1);
          }
        };
      })(this));
      window.addEventListener('click', function() {
        return window.location.hash = '/';
      });
      ref = this.$$voiceSets;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        $voiceSet = ref[j];
        results.push((function($voiceSet) {
          return $voiceSet.addEventListener('click', function(event) {
            if (-1 === this.className.indexOf('active')) {
              window.location.hash = this.id.substr(5).replace(/_/g, '/');
            } else {
              console.log(arts[this.id].voiceSet);
            }
            return event.stopPropagation();
          });
        })($voiceSet));
      }
      return results;
    };

    Main.prototype.updater = function(current) {
      var j, len, ref, voiceSet;
      this.active = null;
      ref = this.voiceSets;
      for (j = 0, len = ref.length; j < len; j++) {
        voiceSet = ref[j];
        if (voiceSet.deactivate) {
          voiceSet.deactivate();
        }
      }
      if (current.voiceSet) {
        this.active = current.voiceSet;
        return this.active.activate();
      }
    };

    return Main;

  })();

  MicIn = (function() {
    MicIn.prototype.C = 'MicIn';

    MicIn.prototype.toString = function() {
      return "[object " + this.C + "]";
    };

    function MicIn(config) {
      if (config == null) {
        config = {};
      }
      this.render = bind(this.render, this);
      this.initStream = bind(this.initStream, this);
      this.callbacks = [];
      if (config.callback) {
        this.callbacks.push(config.callback);
      }
      this.ctxAudio = config.ctxAudio;
      if (!this.ctxAudio) {
        throw new Error('`config.ctxAudio` not provided!');
      }
      this.maestro = config.maestro;
      if (!this.maestro) {
        throw new Error('`config.maestro` not provided!');
      }
      this.initUserMedia();
    }

    MicIn.prototype.initUserMedia = function() {
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
      if (!navigator.getUserMedia) {
        throw new Error('getUserMedia not supported!');
      }
      return navigator.getUserMedia({
        audio: true,
        video: false
      }, this.initStream, function(error) {
        throw new Error('`getUserMedia()` error: ' + error);
      });
    };

    MicIn.prototype.initStream = function(stream) {
      this.streamSource = this.ctxAudio.createMediaStreamSource(stream, 2);
      this.analyser = this.ctxAudio.createAnalyser();
      this.analyser.fftSize = 2048;
      this.bufferLength = this.analyser.frequencyBinCount;
      this.dataArray = new Uint8Array(this.bufferLength);
      this.streamSource.connect(this.analyser);
      return this.maestro.renderers.push(this);
    };

    MicIn.prototype.render = function(cue) {
      var highestPeak, i;
      this.analyser.getByteTimeDomainData(this.dataArray);
      highestPeak = 0;
      i = this.bufferLength;
      while (i--) {
        highestPeak = Math.max(highestPeak, this.dataArray[i]);
      }
      highestPeak = highestPeak / 128.0 - 1;
      if (0.3 < highestPeak) {
        return this.callbacks[0].fn(highestPeak * highestPeak);
      }
    };

    return MicIn;

  })();

  Voice = (function() {
    Voice.prototype.C = 'Voice';

    Voice.prototype.toString = function() {
      return "[object " + this.C + "]";
    };

    function Voice(config) {
      if (config == null) {
        config = {};
      }
      this.flourishes = [];
      this.now = {};
      this.maestro = config.maestro;
      this.hasFocus = false;
      this.size = 16;
      this.$canvas = document.createElement('canvas');
      this.$canvas.setAttribute('width', this.size + 'px');
      this.$canvas.setAttribute('height', this.size + 'px');
      this.$canvas.setAttribute('class', 'icon');
      config.$voiceSet.appendChild(this.$canvas);
      this.icon = this.$canvas.getContext('2d');
      this.visualizer = config.visualizer;
      this.color = this.icon.fillStyle = config.color;
      this.sample = new Asset({
        url: "asset/audio/" + config.sample + ".mp3"
      });
      this.blotRenderer = config.blotRenderer;
    }

    Voice.prototype.activate = function() {
      this.size = 64;
      this.$canvas.setAttribute('width', this.size + 'px');
      this.$canvas.setAttribute('height', this.size + 'px');
      return this.icon.fillStyle = this.color;
    };

    Voice.prototype.deactivate = function() {
      this.size = 16;
      this.$canvas.setAttribute('width', this.size + 'px');
      this.$canvas.setAttribute('height', this.size + 'px');
      return this.icon.fillStyle = this.color;
    };

    Voice.prototype.render = function(frame, visSize) {
      var flourish, j, len, ref, results, time;
      this.now = frame;
      this.icon.clearRect(0, 0, this.size, this.size);
      time = 0.5 > frame.frac2000 ? 1 - frame.frac2000 : frame.frac2000;
      time = (time - 0.5) / 4;
      time += !this.hasFocus ? 0.6 : 0.3;
      this.blotRenderer(time, 1, this.icon, this.size);
      this.visualizer.fillStyle = this.color;
      ref = this.flourishes;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        flourish = ref[j];
        results.push(flourish.render(frame, this.visualizer, visSize));
      }
      return results;
    };

    Voice.prototype.trigger = function(velocity) {
      this.flourishes.push(new Flourish({
        start: this.now.frac2000,
        duration: 0.2,
        velocity: velocity,
        voice: this,
        blotRenderer: this.blotRenderer
      }));
      return this.play(velocity, 0);
    };

    Voice.prototype.play = function(velocity, stamp) {
      var gainNode, source;
      source = this.maestro.audioCtx.createBufferSource();
      source.buffer = this.sample.buffer;
      gainNode = this.maestro.audioCtx.createGain();
      source.connect(gainNode);
      gainNode.connect(this.maestro.audioCtx.destination);
      gainNode.gain.value = velocity;
      return source.start(stamp / 1000);
    };

    Voice.prototype.quieten = function(multiplier, threshold) {
      var flourish, i, results;
      i = this.flourishes.length;
      results = [];
      while (i--) {
        flourish = this.flourishes[i];
        flourish.velocity *= multiplier;
        if (threshold >= flourish.velocity) {
          results.push(this.flourishes.splice(i, 1));
        } else {
          results.push(void 0);
        }
      }
      return results;
    };

    return Voice;

  })();

  VoiceSet = (function() {
    VoiceSet.prototype.C = 'VoiceSet';

    VoiceSet.prototype.toString = function() {
      return "[object " + this.C + "]";
    };

    function VoiceSet(config) {
      var i;
      if (config == null) {
        config = {};
      }
      this.maestro = config.maestro;
      this.ID = config.$voiceSet.id;
      this.focus = 0;
      this.size = 128;
      this.points = config.front.points.split(/\s+/);
      this.colors = config.front.colors.split(/\s+/);
      this.samples = config.front.samples.split(/\s+/);
      this.blots = config.front.blots.split(/\s+/);
      if (5 < this.colors.length) {
        throw new Error("'" + this.ID + "' frontmatter contains " + this.colors.length + " colors");
      }
      if (this.samples.length !== this.colors.length) {
        throw new Error("'" + this.ID + "' frontmatter contains unequal colors and samples");
      }
      if (this.blots.length !== this.colors.length) {
        throw new Error("'" + this.ID + "' frontmatter contains unequal colors and blots");
      }
      this.$canvas = document.createElement('canvas');
      this.$canvas.setAttribute('width', this.size + 'px');
      this.$canvas.setAttribute('height', this.size + 'px');
      this.$canvas.setAttribute('class', 'visualizer');
      config.$voiceSet.appendChild(this.$canvas);
      this.visualizer = this.$canvas.getContext('2d');
      this.visualizer.globalCompositeOperation = 'screen';
      this.voices = [];
      i = this.colors.length;
      while (i--) {
        this.voices.push(new Voice({
          $voiceSet: config.$voiceSet,
          color: this.colors[i],
          sample: this.samples[i],
          blotRenderer: Blot[this.blots[i]],
          visualizer: this.visualizer,
          maestro: this.maestro
        }));
      }
      this.voices[0].focus = true;
    }

    VoiceSet.prototype.activate = function() {
      var j, len, ref, results, voice;
      this.size = 512;
      this.$canvas.setAttribute('width', this.size + 'px');
      this.$canvas.setAttribute('height', this.size + 'px');
      ref = this.voices;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        voice = ref[j];
        results.push(voice.activate());
      }
      return results;
    };

    VoiceSet.prototype.deactivate = function() {
      var j, len, ref, results, voice;
      this.size = 128;
      this.$canvas.setAttribute('width', this.size + 'px');
      this.$canvas.setAttribute('height', this.size + 'px');
      ref = this.voices;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        voice = ref[j];
        results.push(voice.deactivate());
      }
      return results;
    };

    VoiceSet.prototype.render = function(frame) {
      var j, l, len, len1, len2, m, ref, ref1, ref2, results, voice;
      this.visualizer.clearRect(0, 0, this.size, this.size);
      this.visualizer.globalCompositeOperation = 'screen';
      if (frame.flip2000) {
        ref = this.voices;
        for (j = 0, len = ref.length; j < len; j++) {
          voice = ref[j];
          voice.hasFocus = false;
        }
        if (this.voices.length <= ++this.focus) {
          this.focus = 0;
        }
        this.voices[this.focus].hasFocus = true;
        ref1 = this.voices;
        for (l = 0, len1 = ref1.length; l < len1; l++) {
          voice = ref1[l];
          voice.quieten(0.8, 0.05);
        }
      }
      ref2 = this.voices;
      results = [];
      for (m = 0, len2 = ref2.length; m < len2; m++) {
        voice = ref2[m];
        results.push(voice.render(frame, this.size));
      }
      return results;
    };

    VoiceSet.prototype.trigger = function(velocity) {
      return this.voices[this.focus].trigger(velocity);
    };

    return VoiceSet;

  })();

  if (ªF === typeof define && define.amd) {
    define(function() {
      return Main;
    });
  } else if (ªO === typeof module && module && module.exports) {
    module.exports = Main;
  } else {
    this[ªI] = Main;
  }

}).call(this);

//// End injecting plugins. 


//// Run each updater when the page loads, and when the URL hash changes. 
onHashchange();
window.addEventListener('hashchange', onHashchange);


}).call(this, document) });

  </script>

</head>
<body>

  <article id="apage_readme"
        class="apage"
  data-apage-opath="/README.md"
  data-apage-dname="_"
  data-apage-order="-1"
  data-apage-front='[]'
  data-apage-title="Tfmm">
  <h1>Tfmm</h1>
  <h4><a href="">Touchy Feely Music Makey</a></h4>
  <ul>
  <li><a href="http://loop.coop">Loop.Coop</a></li>
  <li><a href="https://www.facebook.com/loopdotcoop">Facebook</a></li>
  <li><a href="https://twitter.com/loopdotcoop">Twitter</a></li>
  <li><a href="#/doc/documentation">Documentation</a></li>
  </ul>
  
  </article><!-- / #apage_readme -->


  <article id="apage_doc_documentation"
        class="apage"
  data-apage-opath="/doc/00-documentation.md"
  data-apage-dname="_doc_"
  data-apage-order="0"
  data-apage-front='[]'
  data-apage-title="Documentation">
  <h1>Documentation</h1>
  <ul>
  <li><a href="">Home</a></li>
  <li><a href="test/run-test.html">Test</a></li>
  <li><a href="https://github.com/loopdotcoop/tfmm">Fork Tfmm on GitHub</a></li>
  <li><a href="#/doc/installing-tfmm">Installing Tfmm</a></li>
  <li><a href="#/doc/testing-tfmm">Testing Tfmm</a></li>
  <li><a href="#/doc/installing-build-tools">Installing Build Tools</a></li>
  <li><a href="#/doc/the-build-process">The Build Process</a></li>
  <li><a href="#/doc/handy-scripts">Handy Scripts</a></li>
  </ul>
  <p>Welcome to the Touchy Feely Music Makey Microsite. @todo add description here</p>
  
  </article><!-- / #apage_doc_documentation -->


  <article id="apage_doc_installing-tfmm"
        class="apage"
  data-apage-opath="/doc/01-installing-tfmm.md"
  data-apage-dname="_doc_"
  data-apage-order="1"
  data-apage-front='[]'
  data-apage-title="Installing Tfmm">
  <h1>Installing Tfmm</h1>
  <p>Old fashioned browser install, providing <code>window.Tfmm</code>: </p>
  <pre><code class="lang-html">&lt;script src=&quot;http://tfmm.loop.coop/build/tfmm.js&quot;&gt;&lt;/script&gt;
  &lt;script&gt;console.log( new window.Tfmm().I ); // -&gt; &#39;Tfmm&#39;&lt;/script&gt;
  </code></pre>
  <p>Install as a <a href="http://goo.gl/ZrbaB0">CommonJS Module</a>, eg for 
  <a href="https://nodejs.org/">Node</a>: </p>
  <pre><code class="lang-javascript">var Tfmm = require(&#39;tfmm&#39;);
  console.log( new Tfmm().I ); // -&gt; &#39;Tfmm&#39;
  </code></pre>
  <p>Install using <a href="http://goo.gl/mp7Snw">RequireJS inline-style</a>, providing <code>Tfmm</code> 
  as an argument: </p>
  <pre><code class="lang-html">&lt;script src=&quot;lib/require.js&quot;&gt;&lt;/script&gt;
  &lt;script&gt;
    require([&#39;path/to/tfmm&#39;], function(Tfmm) {
      console.log( new Tfmm().I ); // -&gt; &#39;Tfmm&#39;
    })
  &lt;/script&gt;
  </code></pre>
  <p>@todo more installation examples</p>
  
  </article><!-- / #apage_doc_installing-tfmm -->


  <article id="apage_voice-set_seamus"
        class="apage"
  data-apage-opath="/voice-set/01-seamus.md"
  data-apage-dname="_voice-set_"
  data-apage-order="1"
  data-apage-front='[["points","5 6  2 3"],["colors","blue         red          gold         silver       pink"],["samples","01-seamus-1  01-seamus-2  01-seamus-3  01-seamus-4  01-seamus-5"],["blots","square       oddtriangle  triangle     dots         galaxy"]]'
  data-apage-title="Bikes n Beer">
  <h1>Bikes n Beer</h1>
  <p>Hitting the gangs of Brighton.</p>
  
  </article><!-- / #apage_voice-set_seamus -->


  <article id="apage_doc_testing-tfmm"
        class="apage"
  data-apage-opath="/doc/02-testing-tfmm.md"
  data-apage-dname="_doc_"
  data-apage-order="2"
  data-apage-front='[]'
  data-apage-title="Testing Tfmm">
  <h1>Testing Tfmm</h1>
  <p>Test with <a href="http://goo.gl/UYupZI">npm run-scripts</a> on the command line: </p>
  <pre><code class="lang-bash">npm test
  </code></pre>
  <p>Test on the client:<br>Open <a href="test/run-test.html">test/run-test.html</a> in 
  a web browser</p>
  
  </article><!-- / #apage_doc_testing-tfmm -->


  <article id="apage_voice-set_chris"
        class="apage"
  data-apage-opath="/voice-set/02-chris.md"
  data-apage-dname="_voice-set_"
  data-apage-order="2"
  data-apage-front='[["points","5 6  2 3"],["colors","blue         green        gold        red"],["samples","02-chris-1   02-chris-2   02-chris-3  02-chris-4"],["blots","dots         square       triangle    oddtriangle"]]'
  data-apage-title="Flicks n Rings">
  <h1>Flicks n Rings</h1>
  <p>Signed advert bikes.</p>
  
  </article><!-- / #apage_voice-set_chris -->


  <article id="apage_doc_installing-build-tools"
        class="apage"
  data-apage-opath="/doc/03-installing-build-tools.md"
  data-apage-dname="_doc_"
  data-apage-order="3"
  data-apage-front='[]'
  data-apage-title="Installing Build Tools">
  <h1>Installing Build Tools</h1>
  <p>The following modules are listed in the <code>&quot;devDependencies&quot;</code> field of 
  ‘package.json’, so running <code>npm install</code> will install them in the local 
  ‘node_modules’ directory. However, you may find it useful to install them 
  globally on your machine, in which case the <code>-g</code> flag is your friend: </p>
  <p>Install <a href="http://coffeescript.org/">coffee</a> 1.9.2 on the command line: </p>
  <pre><code class="lang-bash">npm install -g coffee-script
  </code></pre>
  <p>Install <a href="http://nodemon.io/">nodemon</a> 1.3.7: </p>
  <pre><code class="lang-bash">npm install -g nodemon
  </code></pre>
  
  </article><!-- / #apage_doc_installing-build-tools -->


  <article id="apage_voice-set_george"
        class="apage"
  data-apage-opath="/voice-set/03-george.md"
  data-apage-dname="_voice-set_"
  data-apage-order="3"
  data-apage-front='[["points","5 6  2 3"],["colors","gold          blue          gold         blue         gold"],["samples","03-george-1   03-george-2   03-george-3  03-george-4  03-george-5"],["blots","galaxy        dots          galaxy       dots         galaxy"]]'
  data-apage-title="Anything">
  <h1>Anything</h1>
  <p>A bit of everything.</p>
  
  </article><!-- / #apage_voice-set_george -->


  <article id="apage_doc_the-build-process"
        class="apage"
  data-apage-opath="/doc/04-the-build-process.md"
  data-apage-dname="_doc_"
  data-apage-order="4"
  data-apage-front='[]'
  data-apage-title="The Build Process">
  <h1>The Build Process</h1>
  <h4>Build Tfmm on the command line</h4>
  <pre><code class="lang-bash">npm run build
  </code></pre>
  <p>@todo discussion of the limitations of file-watching.</p>
  
  </article><!-- / #apage_doc_the-build-process -->


  <article id="apage_voice-set_dan"
        class="apage"
  data-apage-opath="/voice-set/04-dan.md"
  data-apage-dname="_voice-set_"
  data-apage-order="4"
  data-apage-front='[["points","1 2  3 4  3 8  1 7"],["colors","cyan        magenta        yellow        white        green"],["samples","04-dan-1    04-dan-2    04-dan-3    04-dan-4  04-dan-5"],["blots","triangle        dots        triangle        square     oddtriangle"]]'
  data-apage-title="DMC’s Noizotron">
  <h1>DMC’s Noizotron</h1>
  <p>Ridiculous and terrible. Like Ivan.</p>
  
  </article><!-- / #apage_voice-set_dan -->


  <article id="apage_doc_handy-scripts"
        class="apage"
  data-apage-opath="/doc/05-handy-scripts.md"
  data-apage-dname="_doc_"
  data-apage-order="5"
  data-apage-front='[]'
  data-apage-title="Handy Scripts">
  <h1>Handy Scripts</h1>
  <h4><code>hi</code></h4>
  <p>Opens up four useful project windows, saving you a few precious seconds at the 
  start of a development session. You will need Sublime Text installed, and a 
  symlink to its <code>subl</code> binary <a href="http://goo.gl/wJqkjY">added to your PATH</a>.<br>@todo cross-platform, eg <code>xdg-open</code> (*nix) and <code>start</code> (win)</p>
  <pre><code class="lang-bash">npm run hi
  </code></pre>
  <p>Which runs: </p>
  <pre><code class="lang-bash">open .; open index.html; open test/run-test.html; subl .
  </code></pre>
  <p>Which means: </p>
  <ol>
  <li>Open the present working directory. On OS X, this opens a Finder window</li>
  <li>Open the project’s local homepage using the default browser</li>
  <li>Open the client-side test page using the default browser</li>
  <li>Open the project in Sublime Text</li>
  </ol>
  <h4><code>v:list</code></h4>
  <p>Shows a list of files which contain the <code>version</code> string from ‘package.json’. 
  Each filename is suffixed by a colon, followed by the line-number where the 
  version string appears, eg <code>README.md:1 package.json:4</code>. </p>
  <pre><code class="lang-bash">npm run v:list
  </code></pre>
  <p>Which runs: </p>
  <pre><code class="lang-bash">grep -ron $npm_package_version {bin,src,*.json} | awk 1 ORS=&#39; &#39; | sed &quot;s@:$npm_package_version@@g&quot;
  </code></pre>
  <p>Or verbosely: </p>
  <pre><code class="lang-bash">grep --recursive --only-matching --line-number $npm_package_version \\
  {bin,src,*.json} \\
  | \\
  awk 1 ORS=&#39; &#39; \\
  | \\
  sed &quot;s@:$npm_package_version@@g&quot;
  </code></pre>
  <p>Which means: </p>
  <ol>
  <li>Use <code>grep</code> to get a newline-delimited list of files which contain the 
  <code>version</code> string from ‘package.json’<ul>
  <li><code>--recursive</code> search in subdirectories</li>
  <li><code>--only-matching</code> don’t show leading/trailing context in the results</li>
  <li><code>--line-number</code> included after a colon, eg <code>bower.json:3</code></li>
  </ul>
  </li>
  <li>Search in bin/, src/, package.json, bower.json, etc</li>
  <li>Pipe the list to <code>awk</code></li>
  <li><a href="http://goo.gl/1WNas5">Convert all newlines to spaces</a></li>
  <li>Pipe the list to <code>sed</code></li>
  <li>Delete the trailing colon and version from each filename, eg <code>:1.2.3-4</code></li>
  </ol>
  <h4><code>v:open</code></h4>
  <p>Opens a list of files which contain the <code>version</code> string from ‘package.json’ in 
  Sublime Text. You will need Sublime Text installed, and a symlink to its <code>subl</code> 
  binary <a href="http://goo.gl/wJqkjY">added to your PATH</a>. </p>
  <pre><code class="lang-bash">npm run v:open
  </code></pre>
  <p>Which runs: </p>
  <pre><code class="lang-bash">subl $(npm run v:list --loglevel silent)
  </code></pre>
  <p>Note <code>--loglevel silent</code>, which prevents <code>subl</code> from being sent the results-log 
  which <code>npm run</code> usually outputs.</p>
  
  </article><!-- / #apage_doc_handy-scripts -->


  <article id="apage_voice-set_sandeep"
        class="apage"
  data-apage-opath="/voice-set/05-sandeep.md"
  data-apage-dname="_voice-set_"
  data-apage-order="5"
  data-apage-front='[["points","1 2  3 4  3 8  1 7"],["colors","pink        blue        purple"],["samples","05-sandeep-1    05-sandeep-2    05-sandeep-3"],["blots","dots        triangle        galaxy"]]'
  data-apage-title="Sandeep Soundz">
  <h1>Sandeep Soundz</h1>
  <p>Taps and brush noise.</p>
  
  </article><!-- / #apage_voice-set_sandeep -->


  <article id="apage_voice-set_cici"
        class="apage"
  data-apage-opath="/voice-set/06-cici.md"
  data-apage-dname="_voice-set_"
  data-apage-order="6"
  data-apage-front='[["points","1 2  3 4  3 8  1 7"],["colors","green  orange  purple  gold  teal"],["samples","06-cici-1  06-cici-2  06-cici-3  06-cici-4  06-cici-5"],["blots","dots        square        triangle        oddtriangle        galaxy"]]'
  data-apage-title="The Croakinator">
  <h1>The Croakinator</h1>
  <p>Croaking drain. Hidden Frog.</p>
  
  </article><!-- / #apage_voice-set_cici -->


  <article id="apage_voice-set_plip"
        class="apage"
  data-apage-opath="/voice-set/07-plip.md"
  data-apage-dname="_voice-set_"
  data-apage-order="7"
  data-apage-front='[["points","1 2  3 4  3 8  1 7"],["colors","#c9f        #ffc      #fcf        cyan        #fcc"],["samples","02-jenny-1  02-jenny-2  02-jenny-3  02-jenny-4  02-jenny-5"],["blots","dots        dots        dots        dots        dots"]]'
  data-apage-title="Plip">
  <h1>Plip</h1>
  <p>Clicks, drops, and dripping taps.</p>
  
  </article><!-- / #apage_voice-set_plip -->


  <!-- ‘Inspect Element’ here, for Apage’s injected elements -->

</body>
</html>